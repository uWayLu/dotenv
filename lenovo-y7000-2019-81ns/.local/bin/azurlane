#!/usr/bin/bash

PORT=5555
DEVICE=localhost:$PORT

if ( adb devices | grep -q "$DEVICE[[:space:]]\+device" ); then
	echo "deivce exists; do mirroring"
else
	TUN="ssh -fNL $PORT:127.0.0.1:5565 win11.lan"
	pkill -f "$TUN"
	$($TUN)
	adb connect $DEVICE
	sleep 1
fi

nohup scrcpy -s $DEVICE \
	--audio-codec=aac \
	--audio-encoder='OMX.google.aac.encoder' \
	--audio-buffer=32
	> /dev/null 2>&1 &
